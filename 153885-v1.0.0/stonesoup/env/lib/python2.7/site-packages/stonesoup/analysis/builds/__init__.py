
import os
from stonesoup.utils import Workspace
from stonesoup.analysis.builds.binary import *
from stonesoup.analysis.builds.source import *



def get_distribution(preferred_list, metadata):
    #Ensure that the install directory is created if not already.
    install_dir = Workspace.make_rel_path_abs(metadata.structure.install)
    if not os.path.exists(install_dir):
        os.makedirs(install_dir)
    try:
        for dist in preferred_list:
            #if we've found the source type.
            if dist == 'source':
            #check to ensure the source directory exists.
                source_exists = os.path.exists(Workspace.make_rel_path_abs(
                                                        metadata.structure.source))

                if(source_exists):
                    #execute a source analysis.
                    source = SourceDistribution(metadata)
                    return source
            else:
                dist_type = return_dist(dist, metadata)

                if dist_type is not None:
                    return dist_type
                else:
                    continue

        #if we get to this point we've failed and must return an error.
        raise DistributionError(
                        'Unable to find suitable binary distribution for performer.')
    except Exception, e:
        raise e